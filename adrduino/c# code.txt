using System;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Windows.Forms;

namespace WindowsFormsApp3
{
    public partial class Form1 : Form
    {
        private const int Port = 5000;

        public Form1()
        {
            InitializeComponent();
        }

        private void button1_Click_1(object sender, EventArgs e)
        {
            TurnOnLed();
        }

        private void TurnOnLed()
        {
            string ArduinoIp = textBox1.Text;

            // Validate the IP address
            if (!IsValidIpAddress(ArduinoIp))
            {
                label11.Text = "Invalid IP address.";
                MessageBox.Show("Please enter a valid IP address.");
                return;
            }

            try
            {
                using (TcpClient client = new TcpClient())
                {
                    client.Connect(ArduinoIp, Port); // Attempt to connect
                    NetworkStream stream = client.GetStream();
                    byte[] message = Encoding.ASCII.GetBytes("ON\n");
                    stream.Write(message, 0, message.Length);
                    label11.Text = "Message sent.";
                }
            }
            catch (SocketException sockEx)
            {
                label11.Text = "Connection error.";
                MessageBox.Show($"Could not connect to the device. Socket Error: {sockEx.Message}");
            }
            catch (Exception ex)
            {
                label11.Text = "Error in sending message.";
                MessageBox.Show($"Error: {ex.Message}");
            }
        }

        private bool IsValidIpAddress(string ipAddress)
        {
            return IPAddress.TryParse(ipAddress, out _);
        }
    }
}